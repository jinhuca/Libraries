<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  
  <ResourceDictionary.MergedDictionaries>
    <ResourceDictionary Source="Shared.xaml"/>
  </ResourceDictionary.MergedDictionaries>

  <ControlTemplate x:Key="TabItemControlTemplate" TargetType="{x:Type TabItem}">
    <ControlTemplate.Resources>
      <Storyboard x:Key="Hovering">
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" 
                                       Storyboard.TargetName="HoverRectangle"
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.1000000" Value="1"/>
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>

      <Storyboard x:Key="HoveringOff">
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" 
                                       Storyboard.TargetName="HoverRectangle" 
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.4000000" Value="0"/>
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>

      <Storyboard x:Key="Selecting">
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" 
                                       Storyboard.TargetName="SelectedRectangle" 
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.1000000" Value="1"/>
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>

      <Storyboard x:Key="SelectingOff">
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" 
                                       Storyboard.TargetName="SelectedRectangle" 
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.4000000" Value="0"/>
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>

      <Storyboard x:Key="Focusing">
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" 
                                       Storyboard.TargetName="SelectedRectangle" 
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.1000000" Value="1"/>
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>

      <Storyboard x:Key="FocusingOff">
        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" 
                                       Storyboard.TargetName="SelectedRectangle" 
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.3000000" Value="0"/>
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>

    </ControlTemplate.Resources>
        
    <Grid x:Name="grid" Margin="0,0,2,2">
      <VisualStateManager.VisualStateGroups>
        <VisualStateGroup x:Name="CommonStates">
          <VisualState x:Name="Normal"/>
          <VisualState x:Name="MouseOver" Storyboard="{StaticResource Hovering}"/>
          <VisualState x:Name="Disabled"/>
        </VisualStateGroup>
        <VisualStateGroup x:Name="FocusStates">
          <VisualState x:Name="Focused" Storyboard="{StaticResource Focusing}"/>
          <VisualState x:Name="Unfocused" Storyboard="{StaticResource FocusingOff}"/>
        </VisualStateGroup>
        <VisualStateGroup x:Name="SelectionStates">
          <VisualState x:Name="Selected" Storyboard="{StaticResource Selecting}"/>
          <VisualState x:Name="Unselected" Storyboard="{StaticResource SelectingOff}"/>
        </VisualStateGroup>
        <VisualStateGroup x:Name="ValidationStates">
          <VisualState x:Name="Valid"/>
          <VisualState x:Name="InvalidFocused"/>
          <VisualState x:Name="InvalidUnfocused"/>
        </VisualStateGroup>
      </VisualStateManager.VisualStateGroups>
      
      <Grid.LayoutTransform>
        <TransformGroup>
          <ScaleTransform ScaleX="1" ScaleY="1"/>
          <SkewTransform AngleX="0" AngleY="0"/>
          <RotateTransform Angle="0"/>
          <TranslateTransform X="0" Y="0"/>
        </TransformGroup>
      </Grid.LayoutTransform>
      
      <Rectangle x:Name="Background" 
                 IsHitTestVisible="False" 
                 Opacity="1">
        <Rectangle.Fill>
          <SolidColorBrush Color="{StaticResource Color_Background_Normal}"/>
        </Rectangle.Fill>
        <Rectangle.Stroke>
          <SolidColorBrush Color="{StaticResource Color_Border_Normal}"/>
        </Rectangle.Stroke>
      </Rectangle>
                 
      <Rectangle x:Name="HoverRectangle" 
                 IsHitTestVisible="False" 
                 Opacity="0">
        <Rectangle.Stroke>
          <SolidColorBrush Color="{StaticResource Color_Border_MouseOver}"/>
        </Rectangle.Stroke>
        <Rectangle.Fill>
          <SolidColorBrush Color="{StaticResource Color_Background_MouseOver_Blue}"/>
        </Rectangle.Fill>
      </Rectangle>
      
      <Rectangle x:Name="SelectedRectangle" 
                 IsHitTestVisible="False" 
                 Opacity="0">
        <Rectangle.Stroke>
          <SolidColorBrush Color="{StaticResource Color_Border_Selected}"/>
        </Rectangle.Stroke>
        <Rectangle.Fill>
          <SolidColorBrush Color="{StaticResource Color_Background_Selected}"/>
        </Rectangle.Fill>
      </Rectangle>
      
      <ContentPresenter x:Name="contentPresenter" 
                        RecognizesAccessKey="True"
                        ContentSource="Header"
                        Margin="7,1"
                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>

    </Grid>
    <ControlTemplate.Triggers>
      <Trigger Property="TabStripPlacement" Value="Left">
        <Setter Property="LayoutTransform" TargetName="grid">
          <Setter.Value>
            <TransformGroup>
              <ScaleTransform ScaleX="1" ScaleY="1" />
              <SkewTransform AngleX="0" AngleY="0" />
              <RotateTransform Angle="-90" />
              <TranslateTransform X="0" Y="0" />
            </TransformGroup>
          </Setter.Value>
        </Setter>
      </Trigger>
      
      <Trigger Property="TabStripPlacement" Value="Right">
        <Setter Property="LayoutTransform" TargetName="grid">
          <Setter.Value>
            <TransformGroup>
              <ScaleTransform ScaleX="1" ScaleY="1" />
              <SkewTransform AngleX="0" AngleY="0" />
              <RotateTransform Angle="90" />
              <TranslateTransform X="0" Y="0" />
            </TransformGroup>
          </Setter.Value>
        </Setter>
      </Trigger>
      
      <Trigger Property="TabStripPlacement" Value="Bottom">
        <Setter Property="LayoutTransform" TargetName="contentPresenter">
          <Setter.Value>
            <TransformGroup>
              <ScaleTransform ScaleX="1" ScaleY="1" />
              <SkewTransform AngleX="0" AngleY="0" />
              <RotateTransform Angle="180" />
              <TranslateTransform X="0" Y="0" />
            </TransformGroup>
          </Setter.Value>
        </Setter>
        <Setter Property="LayoutTransform" TargetName="grid">
          <Setter.Value>
            <TransformGroup>
              <ScaleTransform ScaleX="1" ScaleY="1"/>
              <SkewTransform AngleX="0" AngleY="0"/>
              <RotateTransform Angle="180"/>
              <TranslateTransform X="0" Y="0"/>
            </TransformGroup>
          </Setter.Value>
        </Setter>
      </Trigger>

      <MultiTrigger>
        <MultiTrigger.Conditions>
          <Condition Property="IsMouseOver" Value="True"/>
          <Condition Property="Selector.IsSelected" Value="False"/>
        </MultiTrigger.Conditions>
        <MultiTrigger.ExitActions>
          <BeginStoryboard Storyboard="{StaticResource HoveringOff}"/>
        </MultiTrigger.ExitActions>
        <MultiTrigger.EnterActions>
          <BeginStoryboard Storyboard="{StaticResource Hovering}"/>
        </MultiTrigger.EnterActions>
      </MultiTrigger>

      <MultiTrigger>
        <MultiTrigger.Conditions>
          <Condition Property="IsMouseOver" Value="True"/>
          <Condition Property="Selector.IsSelected" Value="True"/>
        </MultiTrigger.Conditions>
        <Setter Property="Fill" 
                TargetName="Background" 
                Value="{StaticResource Brush_Background_MouseOver}"/>
        <Setter Property="Opacity" TargetName="Background" Value="0.9"/>
      </MultiTrigger>
      
      <Trigger Property="IsSelected" Value="True">
        <Trigger.ExitActions>
          <BeginStoryboard Storyboard="{StaticResource SelectingOff}"/>
        </Trigger.ExitActions>
        <Trigger.EnterActions>
          <BeginStoryboard Storyboard="{StaticResource Selecting}"/>
        </Trigger.EnterActions>
        <Setter Property="Panel.ZIndex" Value="100"/>
      </Trigger>
      
      <Trigger Property="IsEnabled" Value="False">
        <Setter Property="Foreground" Value="{DynamicResource DisabledForegroundBrush}"/>
        <Setter Property="Fill" TargetName="Background" Value="{StaticResource Brush_Background_Disable}"/>
        <Setter Property="Opacity" TargetName="grid" Value="0.3"/>
      </Trigger>
    </ControlTemplate.Triggers>
  </ControlTemplate>

  <Style TargetType="{x:Type TabItem}">
    <Setter Property="Foreground" Value="{StaticResource Brush_Foreground_Normal}"/>
    <Setter Property="Template" Value="{StaticResource TabItemControlTemplate}"/>
    <Style.Triggers>
      <Trigger Property="Selector.IsSelected" Value="True">
        <Setter Property="Foreground" Value="{StaticResource Brush_Foreground_Selected}"/>
      </Trigger>
      <Trigger Property="IsMouseOver" Value="True">
        <Setter Property="Foreground" Value="{StaticResource Brush_Foreground_MouseOver}"/>
      </Trigger>
    </Style.Triggers>
  </Style>
</ResourceDictionary>