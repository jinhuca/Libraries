<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <ResourceDictionary.MergedDictionaries>
    <ResourceDictionary Source="Shared.xaml"/>
  </ResourceDictionary.MergedDictionaries>

  <ControlTemplate x:Key="RichTextTemplate" TargetType="{x:Type RichTextBox}">
    <ControlTemplate.Resources>
      <Storyboard x:Key="HoverOn">
        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="HoverBorder" 
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.1000000" Value="0.5" />
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>
      <Storyboard x:Key="HoverOff">
        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="HoverBorder" 
                                       Storyboard.TargetProperty="(UIElement.Opacity)">
          <SplineDoubleKeyFrame KeyTime="00:00:00.4000000" Value="0" />
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>
      <Storyboard x:Key="FocusedOn">
        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusVisualElement" 
                                       Storyboard.TargetProperty="Opacity">
          <SplineDoubleKeyFrame KeyTime="00:00:00.1000000" Value="1" />
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>
      <Storyboard x:Key="FocusedOff">
        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusVisualElement" 
                                       Storyboard.TargetProperty="Opacity">
          <SplineDoubleKeyFrame KeyTime="00:00:00.4000000" Value="0" />
        </DoubleAnimationUsingKeyFrames>
      </Storyboard>
    </ControlTemplate.Resources>
    <Grid>
      <Border x:Name="Border" 
              Opacity="1" 
              BorderBrush="{TemplateBinding BorderBrush}" 
              BorderThickness="{TemplateBinding BorderThickness}" 
              CornerRadius="2,2,2,2" 
              Background="{TemplateBinding Background}">
        <Grid>
          <Border BorderThickness="1">
            <ScrollViewer Margin="0" x:Name="PART_ContentHost" Style="{DynamicResource ScrollViewer}" />
          </Border>
        </Grid>
      </Border>
      <Border x:Name="HoverBorder" 
              IsHitTestVisible="False" 
              Opacity="0" 
              BorderBrush="{DynamicResource Brush_Border_MouseOver}" 
              BorderThickness="{TemplateBinding BorderThickness}" 
              CornerRadius="2"/>
      <Border x:Name="FocusVisualElement" 
              IsHitTestVisible="False" 
              Opacity="0" 
              BorderBrush="{DynamicResource Brush_Border_Focused}" 
              BorderThickness="{TemplateBinding BorderThickness}" 
              CornerRadius="2"/>
    </Grid>
    <ControlTemplate.Triggers>
      <Trigger Property="IsFocused" Value="True">
        <Trigger.ExitActions>
          <BeginStoryboard Storyboard="{StaticResource FocusedOff}" x:Name="FocusedOff_BeginStoryboard"/>
        </Trigger.ExitActions>
        <Trigger.EnterActions>
          <BeginStoryboard Storyboard="{StaticResource FocusedOn}" x:Name="FocusedOn_BeginStoryboard"/>
        </Trigger.EnterActions>

      </Trigger>
      <MultiTrigger>
        <MultiTrigger.ExitActions>
          <BeginStoryboard Storyboard="{StaticResource HoverOff}" x:Name="HoverOff_BeginStoryboard"/>
        </MultiTrigger.ExitActions>
        <MultiTrigger.EnterActions>
          <BeginStoryboard Storyboard="{StaticResource HoverOn}"/>
        </MultiTrigger.EnterActions>
        <MultiTrigger.Conditions>
          <Condition Property="IsMouseOver" Value="True" />
          <Condition Property="IsFocused" Value="False" />
        </MultiTrigger.Conditions>

      </MultiTrigger>
      <Trigger Property="IsEnabled" Value="False">
        <Setter Property="Background" TargetName="Border" Value="{DynamicResource Brush_Background_Disable}"/>
        <Setter Property="BorderBrush" TargetName="Border" Value="{DynamicResource Brush_Border_Disable}"/>
        <Setter Property="Foreground" Value="{DynamicResource Brush_Foreground_Disable}"/>
      </Trigger>
    </ControlTemplate.Triggers>
  </ControlTemplate>
  
  <Style TargetType="{x:Type RichTextBox}">
    <Setter Property="Template" Value="{StaticResource RichTextTemplate}"/>
    <Setter Property="Foreground" Value="{StaticResource Brush_Foreground_Normal}"/>
    <Setter Property="Background" Value="{StaticResource Brush_Background_Normal}"/>
    <Setter Property="BorderBrush" Value="{StaticResource Brush_Border_Normal}"/>
    <Setter Property="KeyboardNavigation.TabNavigation" Value="None"/>
    <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
    <Setter Property="AllowDrop" Value="true"/>
  </Style>
  
</ResourceDictionary>